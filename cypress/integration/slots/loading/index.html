<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link
      type="text/css"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    />
    <link type="text/css" rel="stylesheet" href="/dist/index.css" />
    <script src="https://unpkg.com/vue@next/dist/vue.global.prod.js"></script>
  </head>

  <body>
    <div id="app"></div>
    <script src="/dist/vue-next-select.iife.js"></script>
    <script>
      const { ref, computed, createApp } = Vue

      const useLoading = () => {
        const loadingCount = ref(0)
        return {
          loading: computed(() => loadingCount.value !== 0),
          load: () => {
            loadingCount.value++
          },
          unload: () => {
            loadingCount.value--
          },
        }
      }

      const app = createApp({
        name: 'app',
        setup() {
          const model = ref([])

          const options = ref([])

          const { loading, load, unload } = useLoading()
          const handleSearchInput = async event => {
            load()
            new Promise(resolve => {
              setTimeout(() => {
                unload()
              }, 100)
            })
          }

          return {
            model,
            options,
            loading,
            handleSearchInput,
          }
        },
        template: `
          <vue-select
            v-model="model"
            :options="options"
            multiple
            searchable
            @search:input="handleSearchInput"
            :loading="loading"
          >
            <template #caret="{ isFocusing, isLoading, toggle }">
              <div class="caret">
                <div v-if="isLoading">loading</div>
                <div v-else-if="isFocusing" @click="toggle" @mousedown.prevent.stop>opening</div>
                <div v-else>closing</div>
              </div>
            </template>
            <template #loading="{ isFocusing, isLoading, toggle }">
              <div class="loading">
                <div v-if="isLoading">loading</div>
                <div v-else-if="isFocusing" @click="toggle" @mousedown.prevent.stop>opening</div>
                <div v-else>closing</div>
              </div>
            </template>
          </vue-select>
        `,
      })

      app.component('vue-select', VueNextSelect)
      app.mount(document.querySelector('#app'))
    </script>
  </body>
</html>
